<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MYAN MYAN LEARN - Contents</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/tailwind-config.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .show {
        opacity: 1 !important;
        visibility: visible !important;
        transform: translateY(0) !important;
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800 font-sans text-gray-800 flex flex-col"
  >
    <nav th:replace="fragments/navbar :: appNavbar('Learning Platform')"></nav>

    <main class="flex-1 pt-28 pb-16">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between mb-6">
          <h1
            class="text-white text-2xl sm:text-3xl font-bold flex items-center gap-3 flex-1 min-w-0"
          >
            <span
              th:if="${courseTitle}"
              class="block truncate text-white text-2xl sm:text-3xl font-bold"
              th:text="${courseTitle}"
              >Course Title</span
            >
          </h1>
          <a
            href="/home"
            class="flex items-center gap-2 text-white/80 hover:text-white transition bg-white/10 hover:bg-white/15 px-3 py-2 rounded-lg no-underline flex-shrink-0"
          >
            <i class="fas fa-arrow-left text-xs"></i>
            <span th:text="#{reader.back}">Back</span>
          </a>
        </div>

        <!-- Tabs -->
        <div class="flex border-b border-white/20 mb-6">
          <button
            id="learnTab"
            class="px-4 py-2 text-sm font-medium text-white border-b-2 border-blue-400 focus:outline-none transition-colors"
            onclick="switchTab('learn')"
          >
            Learn
          </button>
          <button
            id="vocabTab"
            class="px-4 py-2 text-sm font-medium text-white/70 hover:text-white border-b-2 border-transparent hover:border-white/30 focus:outline-none transition-colors"
            onclick="switchTab('vocab')"
          >
            Learn Vocabulary
          </button>
          <button
            id="testTab"
            class="px-4 py-2 text-sm font-medium text-white/70 hover:text-white border-b-2 border-transparent hover:border-white/30 focus:outline-none transition-colors"
            onclick="switchTab('test')"
          >
            Assessment
          </button>
        </div>

        <!-- Test Tab Content -->
        <div id="testContent" class="space-y-4 hidden">
          <div class="flex justify-end mb-4 gap-3">
            <button
              id="randomSelectBtn"
              class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center gap-2"
              onclick="selectRandomChapters()"
            >
              <i class="fas fa-random"></i>
              <span>Random Select</span>
            </button>
            <button
              id="selectAllToggleBtn"
              class="px-4 py-2 bg-white/10 hover:bg-white/15 text-white rounded-lg transition-colors flex items-center gap-2 border border-white/20"
              type="button"
              onclick="toggleSelectAllChapters()"
            >
              <i class="fas fa-check-square"></i>
              <span id="selectAllToggleLabel">Select All</span>
            </button>
          </div>

          <div class="space-y-3" id="chapterList">
            <div
              th:if="${course != null}"
              th:each="content, ci : ${course.contents}"
              class="chapter-item"
              th:data-chapter-id="${content.order}"
            >
              <label
                class="flex items-center p-3 bg-white/10 rounded-lg border border-white/10 cursor-pointer hover:bg-white/15 transition-colors"
              >
                <input
                  type="checkbox"
                  class="hidden chapter-checkbox"
                  th:value="${content.order}"
                />
                <div
                  class="w-5 h-5 border-2 border-white/50 rounded flex-shrink-0 mr-3 flex items-center justify-center transition-colors checkbox-custom"
                >
                  <i class="fas fa-check text-white text-xs opacity-0"></i>
                </div>
                <div class="flex-1">
                  <div
                    class="text-white font-medium"
                    th:text="${content.chapter + ': ' + content.title}"
                  ></div>
                </div>
              </label>
            </div>
          </div>

          <div class="mt-6 pt-4 border-t border-white/10">
            <button
              id="takeTestBtn"
              class="w-full py-3 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              <i class="fas fa-play"></i>
              <span>Take Test</span>
            </button>
          </div>
        </div>

        <!-- Learn Vocabulary Tab Content -->
        <div id="vocabContent" class="space-y-3 hidden">
          <div
            th:if="${course != null}"
            class="grid grid-cols-1 sm:grid-cols-2 gap-3"
          >
            <button
              type="button"
              class="w-full flex flex-col items-start gap-1 px-4 py-3 bg-white/10 border border-white/10 rounded-lg text-left text-white/90 hover:bg-white/15 transition-colors"
              th:each="content, ci : ${course.contents}"
            >
              <span
                class="text-xs text-white/70"
                th:text="${content.chapter != null ? content.chapter : 'Chapter ' + content.order}"
              ></span>
              <span
                class="font-medium truncate"
                th:text="${content.title}"
              ></span>
            </button>
          </div>
        </div>

        <!-- Learn Tab Content -->
        <div id="learnContent" class="space-y-3">
          <div
            th:if="${course != null}"
            th:each="content, ci : ${course.contents}"
            class="bg-white/10 border border-white/10 rounded-xl p-3 sm:p-4 content-item"
          >
            <button
              class="w-full flex items-start gap-3 sm:gap-4 text-left group content-toggle"
              aria-expanded="false"
            >
              <div class="relative w-10 h-10 sm:w-12 sm:h-12">
                <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="stroke-white/20"
                    stroke-width="4"
                  ></circle>
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="progress-ring stroke-blue-400"
                    stroke-width="4"
                    stroke-linecap="round"
                  ></circle>
                </svg>
                <span
                  class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold progress-text"
                  >0%</span
                >
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex flex-col gap-0.5 leading-tight">
                  <span
                    class="text-xs sm:text-sm text-white/70"
                    th:text="${content.chapter != null ? content.chapter : 'Chapter ' + content.order}"
                    >Chapter</span
                  >
                  <span
                    class="text-white font-semibold text-sm sm:text-base truncate"
                    th:text="${content.title}"
                    >Chapter Title</span
                  >
                </div>
              </div>
              <i
                class="fas fa-chevron-down text-white/70 text-xs sm:text-sm transition-transform content-arrow"
              ></i>
            </button>
            <div
              class="mt-2 pl-11 sm:pl-14 space-y-2 content-sublist max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-out"
            >
              <a
                class="block text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition no-underline"
                th:each="sub, si : ${content.subcontents}"
                th:href="@{/reader(courseId=${course.id}, ch=${content.order}, sc=${sub.order})}"
              >
                <div class="flex items-center gap-3">
                  <span
                    class="truncate"
                    th:text="${content.order + '-' + sub.order + ' ' + sub.title}"
                    >1.1 Subcontent</span
                  >
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 0%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >0%</span
                      >
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>

          <div
            class="bg-white/10 border border-white/10 rounded-xl p-3 sm:p-4 hidden"
            th:remove="all"
          >
            <button
              class="w-full flex items-start gap-3 sm:gap-4 text-left group content-toggle"
              aria-expanded="false"
            >
              <div class="relative w-10 h-10 sm:w-12 sm:h-12">
                <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="stroke-white/20"
                    stroke-width="4"
                  ></circle>
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="progress-ring stroke-blue-400"
                    stroke-width="4"
                    stroke-linecap="round"
                  ></circle>
                </svg>
                <span
                  class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold progress-text"
                  >30%</span
                >
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex flex-col gap-0.5 leading-tight">
                  <span class="text-xs sm:text-sm text-white/70"
                    >Chapter 2</span
                  >
                  <span
                    class="text-white font-semibold text-sm sm:text-base truncate"
                    >Nouns and Pronouns</span
                  >
                </div>
              </div>
              <i
                class="fas fa-chevron-down text-white/70 text-xs sm:text-sm transition-transform content-arrow"
              ></i>
            </button>
            <div
              class="mt-2 pl-11 sm:pl-14 space-y-2 content-sublist max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-out"
            >
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">2.1 Countable vs Uncountable</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 35%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >35%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">2.2 Pronoun Agreement</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 60%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >60%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            class="bg-white/10 border border-white/10 rounded-xl p-3 sm:p-4 hidden"
            th:remove="all"
          >
            <button
              class="w-full flex items-start gap-3 sm:gap-4 text-left group content-toggle"
              aria-expanded="false"
            >
              <div class="relative w-10 h-10 sm:w-12 sm:h-12">
                <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="stroke-white/20"
                    stroke-width="4"
                  ></circle>
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="progress-ring stroke-blue-400"
                    stroke-width="4"
                    stroke-linecap="round"
                  ></circle>
                </svg>
                <span
                  class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold progress-text"
                  >45%</span
                >
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex flex-col gap-0.5 leading-tight">
                  <span class="text-xs sm:text-sm text-white/70"
                    >Chapter 3</span
                  >
                  <span
                    class="text-white font-semibold text-sm sm:text-base truncate"
                    >Verbs and Tenses</span
                  >
                </div>
              </div>
              <i
                class="fas fa-chevron-down text-white/70 text-xs sm:text-sm transition-transform content-arrow"
              ></i>
            </button>
            <div
              class="mt-2 pl-11 sm:pl-14 space-y-2 content-sublist max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-out"
            >
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">3.1 Present Tenses</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 20%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >20%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">3.2 Past Tenses</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 40%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >40%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">3.3 Future Forms</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 55%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >55%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            class="bg-white/10 border border-white/10 rounded-xl p-3 sm:p-4 hidden"
            th:remove="all"
          >
            <button
              class="w-full flex items-start gap-3 sm:gap-4 text-left group content-toggle"
              aria-expanded="false"
            >
              <div class="relative w-10 h-10 sm:w-12 sm:h-12">
                <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="stroke-white/20"
                    stroke-width="4"
                  ></circle>
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="progress-ring stroke-blue-400"
                    stroke-width="4"
                    stroke-linecap="round"
                  ></circle>
                </svg>
                <span
                  class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold progress-text"
                  >60%</span
                >
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex flex-col gap-0.5 leading-tight">
                  <span class="text-xs sm:text-sm text-white/70"
                    >Chapter 4</span
                  >
                  <span
                    class="text-white font-semibold text-sm sm:text-base truncate"
                    >Adjectives and Adverbs</span
                  >
                </div>
              </div>
              <i
                class="fas fa-chevron-down text-white/70 text-xs sm:text-sm transition-transform content-arrow"
              ></i>
            </button>
            <div
              class="mt-2 pl-11 sm:pl-14 space-y-2 content-sublist max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-out"
            >
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">4.1 Comparative Forms</span>
                  <div class="w-3/12 ml-auto">
                    <div class="h-4 bg-white/10 rounded-full overflow-hidden">
                      <div
                        class="h-full bg-blue-400 rounded-full relative"
                        style="width: 30%"
                      >
                        <span
                          class="absolute inset-0 flex items-center justify-center text-[10px] text-white/90"
                          >30%</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">4.2 Superlatives</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 70%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >70%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            class="bg-white/10 border border-white/10 rounded-xl p-3 sm:p-4"
            th:remove="all"
          >
            <button
              class="w-full flex items-start gap-3 sm:gap-4 text-left group content-toggle"
              aria-expanded="false"
            >
              <div class="relative w-10 h-10 sm:w-12 sm:h-12">
                <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="stroke-white/20"
                    stroke-width="4"
                  ></circle>
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="progress-ring stroke-blue-400"
                    stroke-width="4"
                    stroke-linecap="round"
                  ></circle>
                </svg>
                <span
                  class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold progress-text"
                  >75%</span
                >
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex flex-col gap-0.5 leading-tight">
                  <span class="text-xs sm:text-sm text-white/70"
                    >Chapter 5</span
                  >
                  <span
                    class="text-white font-semibold text-sm sm:text-base truncate"
                    >Prepositions</span
                  >
                </div>
              </div>
              <i
                class="fas fa-chevron-down text-white/70 text-xs sm:text-sm transition-transform content-arrow"
              ></i>
            </button>
            <div
              class="mt-2 pl-11 sm:pl-14 space-y-2 content-sublist max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-out"
            >
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">5.1 Place and Time</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 45%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >45%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">5.2 Common Phrases</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 80%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >80%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            class="bg-white/10 border border-white/10 rounded-xl p-3 sm:p-4"
            th:remove="all"
          >
            <button
              class="w-full flex items-start gap-3 sm:gap-4 text-left group content-toggle"
              aria-expanded="false"
            >
              <div class="relative w-10 h-10 sm:w-12 sm:h-12">
                <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="stroke-white/20"
                    stroke-width="4"
                  ></circle>
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="progress-ring stroke-blue-400"
                    stroke-width="4"
                    stroke-linecap="round"
                  ></circle>
                </svg>
                <span
                  class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold progress-text"
                  >10%</span
                >
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex flex-col gap-0.5 leading-tight">
                  <span class="text-xs sm:text-sm text-white/70"
                    >Chapter 6</span
                  >
                  <span
                    class="text-white font-semibold text-sm sm:text-base truncate"
                    >Conjunctions</span
                  >
                </div>
              </div>
              <i
                class="fas fa-chevron-down text-white/70 text-xs sm:text-sm transition-transform content-arrow"
              ></i>
            </button>
            <div
              class="mt-2 pl-11 sm:pl-14 space-y-2 content-sublist max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-out"
            >
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">6.1 Coordinating</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 15%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >15%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">6.2 Subordinating</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 35%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >35%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            class="bg-white/10 border border-white/10 rounded-xl p-3 sm:p-4"
            th:remove="all"
          >
            <button
              class="w-full flex items-start gap-3 sm:gap-4 text-left group content-toggle"
              aria-expanded="false"
            >
              <div class="relative w-10 h-10 sm:w-12 sm:h-12">
                <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="stroke-white/20"
                    stroke-width="4"
                  ></circle>
                  <circle
                    cx="18"
                    cy="18"
                    r="15"
                    fill="none"
                    class="progress-ring stroke-blue-400"
                    stroke-width="4"
                    stroke-linecap="round"
                  ></circle>
                </svg>
                <span
                  class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold progress-text"
                  >0%</span
                >
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex flex-col gap-0.5 leading-tight">
                  <span class="text-xs sm:text-sm text-white/70"
                    >Chapter 7</span
                  >
                  <span
                    class="text-white font-semibold text-sm sm:text-base truncate"
                    >Practice Exercises</span
                  >
                </div>
              </div>
              <i
                class="fas fa-chevron-down text-white/70 text-xs sm:text-sm transition-transform content-arrow"
              ></i>
            </button>
            <div
              class="mt-2 pl-11 sm:pl-14 space-y-2 content-sublist max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-out"
            >
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">7.1 Quiz 1</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-400 rounded-full"
                        style="width: 0%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >0%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="text-white/90 text-xs sm:text-sm cursor-pointer hover:text-white hover:underline hover:bg-white/5 rounded-md px-2 py-1 transition"
                tabindex="0"
              >
                <div class="flex items-center gap-3">
                  <span class="truncate">7.2 Quiz 2</span>
                  <div class="w-3/12 ml-auto">
                    <div
                      class="h-4 bg-white/10 rounded-full overflow-hidden relative"
                    >
                      <div
                        class="h-full bg-blue-500 rounded-full"
                        style="width: 0%"
                      ></div>
                      <span
                        class="absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs font-semibold text-white/90"
                        >0%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Toggle chapter selection
      function toggleChapterSelection(checkbox) {
        const label = checkbox.closest("label");
        const customCheckbox = label.querySelector(".checkbox-custom");
        const checkIcon = customCheckbox.querySelector("i");

        if (checkbox.checked) {
          customCheckbox.classList.add("bg-blue-500", "border-blue-500");
          checkIcon.classList.remove("opacity-0");
        } else {
          customCheckbox.classList.remove("bg-blue-500", "border-blue-500");
          checkIcon.classList.add("opacity-0");
        }

        // Enable/disable Take Test button based on selection
        const hasSelection =
          document.querySelectorAll(".chapter-checkbox:checked").length > 0;
        document.getElementById("takeTestBtn").disabled = !hasSelection;
      }

      // Select random chapters
      function selectRandomChapters() {
        const checkboxes = Array.from(
          document.querySelectorAll(".chapter-checkbox")
        );
        if (checkboxes.length === 0) return;

        // Clear all selections
        checkboxes.forEach((checkbox) => {
          checkbox.checked = false;
          toggleChapterSelection(checkbox);
        });

        // Select random chapters (at least 1, at most all)
        const randomCount = Math.max(
          1,
          Math.floor(Math.random() * checkboxes.length) + 1
        );
        const shuffled = [...checkboxes].sort(() => 0.5 - Math.random());

        for (let i = 0; i < randomCount; i++) {
          const checkbox = shuffled[i];
          checkbox.checked = true;
          toggleChapterSelection(checkbox);
        }
      }

      function toggleSelectAllChapters() {
        const checkboxes = Array.from(
          document.querySelectorAll(".chapter-checkbox")
        );
        if (checkboxes.length === 0) return;

        const labelEl = document.getElementById("selectAllToggleLabel");
        if (!labelEl) return;

        const selectingAll = labelEl.textContent.trim() === "Select All";

        checkboxes.forEach((checkbox) => {
          checkbox.checked = selectingAll;
          toggleChapterSelection(checkbox);
        });

        labelEl.textContent = selectingAll ? "Deselect All" : "Select All";
      }

      function switchTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll('[id$="Content"]').forEach((el) => {
          el.classList.add("hidden");
        });

        // Show selected tab content
        const activeContent = document.getElementById(tabName + "Content");
        if (activeContent) {
          activeContent.classList.remove("hidden");
        }

        // Update tab styles
        document.querySelectorAll('[id$="Tab"]').forEach((tab) => {
          if (tab.id === tabName + "Tab") {
            tab.classList.remove(
              "text-white/70",
              "border-transparent",
              "hover:border-white/30"
            );
            tab.classList.add("text-white", "border-blue-400");
          } else {
            tab.classList.remove("text-white", "border-blue-400");
            tab.classList.add(
              "text-white/70",
              "border-transparent",
              "hover:border-white/30"
            );
          }
        });

        // Initialize accordion for the active tab
        if (tabName === "learn") {
          initAccordion();
        }
      }

      function initAccordion() {
        const learnContent = document.getElementById("learnContent");
        if (!learnContent) return;

        // Initialize progress circles
        const rings = Array.from(
          learnContent.querySelectorAll(".progress-ring")
        );
        const texts = Array.from(
          learnContent.querySelectorAll(".progress-text")
        );

        const radius = 15;
        const circumference = 2 * Math.PI * radius;
        rings.forEach((ring, idx) => {
          const text = texts[idx];
          if (!text) return;
          const percent = parseInt(text.textContent.replace("%", "")) || 0;
          ring.setAttribute("stroke-dasharray", `${circumference}`);
          const offset = circumference - (percent / 100) * circumference;
          ring.setAttribute("stroke-dashoffset", `${offset}`);
        });

        // Initialize the first item as expanded by default if needed
        const firstItem = learnContent.querySelector(".content-item");
        if (firstItem) {
          const firstToggle = firstItem.querySelector(".content-toggle");
          if (firstToggle) firstToggle.click();
        }
      }

      // Handle accordion toggle
      function handleAccordionToggle(e) {
        const toggleBtn = e.target.closest(".content-toggle");
        if (!toggleBtn) return;

        e.preventDefault();
        const item = toggleBtn.closest(".content-item");
        const sub = item ? item.querySelector(".content-sublist") : null;
        const arrow = toggleBtn.querySelector(".content-arrow");
        const isExpanded = toggleBtn.getAttribute("aria-expanded") === "true";

        // Close all other items
        document.querySelectorAll(".content-item").forEach((otherItem) => {
          if (otherItem !== item) {
            const otherSub = otherItem.querySelector(".content-sublist");
            const otherBtn = otherItem.querySelector(".content-toggle");
            const otherArrow = otherBtn
              ? otherBtn.querySelector(".content-arrow")
              : null;

            if (otherSub) {
              otherSub.classList.remove(
                "max-h-40",
                "sm:max-h-60",
                "opacity-100"
              );
              otherSub.classList.add("max-h-0", "opacity-0");
            }
            if (otherBtn) otherBtn.setAttribute("aria-expanded", "false");
            if (otherArrow) otherArrow.classList.remove("rotate-180");
          }
        });

        // Toggle current item
        if (!isExpanded && sub) {
          sub.classList.remove("max-h-0", "opacity-0");
          sub.classList.add("max-h-40", "sm:max-h-60", "opacity-100");
          toggleBtn.setAttribute("aria-expanded", "true");
          if (arrow) arrow.classList.add("rotate-180");
        } else if (sub) {
          sub.classList.remove("max-h-40", "sm:max-h-60", "opacity-100");
          sub.classList.add("max-h-0", "opacity-0");
          toggleBtn.setAttribute("aria-expanded", "false");
          if (arrow) arrow.classList.remove("rotate-180");
        }
      }

      // Handle chapter selection
      document.addEventListener("click", function (e) {
        // Handle accordion toggles
        if (e.target.closest(".content-toggle")) {
          handleAccordionToggle(e);
        }

        // Handle chapter checkbox clicks
        const label = e.target.closest('label[class*="flex items-center"]');
        if (label) {
          const checkbox = label.querySelector(".chapter-checkbox");
          if (checkbox) {
            checkbox.checked = !checkbox.checked;
            toggleChapterSelection(checkbox);
          }
        }

        // Handle Take Test button click
        if (e.target.closest("#takeTestBtn") || e.target.id === "takeTestBtn") {
          const selectedChapters = Array.from(
            document.querySelectorAll(".chapter-checkbox:checked")
          ).map((checkbox) => checkbox.value);

          if (selectedChapters.length > 0) {
            // TODO: Navigate to test screen with selected chapters
            console.log("Selected chapters for test:", selectedChapters);
            // Example: window.location.href = `/test?chapters=${selectedChapters.join(',')}`;
          }
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        // Display selected course title from query string or localStorage
        const selectedTitleEl = document.getElementById("selectedCourseTitle");
        const params = new URLSearchParams(window.location.search);
        const courseTitle =
          params.get("course") || localStorage.getItem("selectedCourse");

        if (selectedTitleEl) {
          if (courseTitle) {
            selectedTitleEl.textContent = courseTitle;
            selectedTitleEl.classList.remove("hidden");
          } else {
            selectedTitleEl.classList.add("hidden");
          }
        }

        // Initialize the first tab as active
        switchTab("learn");
      });
    </script>
    <script src="/js/navbar.js"></script>
  </body>
</html>
