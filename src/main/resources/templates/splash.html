<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="#{splash.pageTitle}">MYAN MYAN LEARN - Loading</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/tailwind-config.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .shimmer-animation {
        animation: shimmer 1.5s ease-in-out infinite;
      }
    </style>
  </head>

  <body
    class="h-screen font-sans flex items-center justify-center overflow-hidden"
  >
    <div class="w-full max-w-4xl px-8 flex flex-col items-center text-center">
      <img
        th:src="@{/images/logo.svg}"
        th:alt="#{splash.logoAlt}"
        alt="Myan Myan Learn"
        class="w-48 h-auto mb-8 drop-shadow-lg"
      />
      <div
        class="text-4xl font-black text-white mb-8 tracking-wider brand-font"
        th:text="#{app.brand}"
      >
        Myan Myan Learn
      </div>

      <!-- Progress Bar -->
      <div class="w-full max-w-xs">
        <div
          class="bg-white/20 backdrop-blur-sm rounded-full h-2 overflow-hidden relative"
        >
          <div
            class="bg-white/80 h-full rounded-full transition-all duration-300 relative overflow-hidden"
            id="progressBar"
            style="width: 0%"
          >
            <!-- Loading animation shimmer effect -->
            <div
              class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse shimmer-animation"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Function to get cookie value
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
        return null;
      }

      // Check for existing language preference
      function checkLanguagePreference() {
        const savedLanguage =
          getCookie("selectedLanguage") ||
          localStorage.getItem("selectedLanguage");
        return savedLanguage;
      }

      // Check if intro has been completed
      function checkIntroCompletion() {
        const introCompleted = getCookie("introCompleted");
        return introCompleted;
      }

      // Progress bar animation - 0% to 100% in 3 seconds
      const progressBar = document.getElementById("progressBar");
      const totalDuration = 3000; // 3 seconds in milliseconds
      const startTime = Date.now();

      function updateProgress() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min((elapsed / totalDuration) * 100, 100);

        progressBar.style.width = progress + "%";

        if (progress < 100) {
          requestAnimationFrame(updateProgress);
        } else {
          // Check for existing language preference and intro completion
          const savedLanguage = checkLanguagePreference();
          const introCompleted = checkIntroCompletion();

          // Determine next step based on user progress
          setTimeout(function () {
            if (savedLanguage) {
              // Language already selected, check if intro completed
              if (introCompleted) {
                // Both language and intro completed, go to home
                window.location.href = "/home";
              } else {
                // Language selected but intro not completed, go to intro
                window.location.href = "/intro";
              }
            } else {
              // No language selected yet, go to language selection
              window.location.href = "/language";
            }
          }, 100);
        }
      }

      // Start the animation
      requestAnimationFrame(updateProgress);
    </script>
  </body>
</html>
