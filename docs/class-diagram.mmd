%% Mermaid Class Diagram for MyanMyanLearn
classDiagram
  direction LR

  %% Models / Entities
  class Course {
    +String id
    +String title
    +String description
    +String logo
    +List<Content> contents
  }

  class Content {
    +int order
    +String chapter
    +String title
    +List<Subcontent> subcontents
  }

  class Subcontent {
    +int order
    +String title
    +String markdownPath
  }

  class Member {
    +String userId
    +Boolean active
    +String email
    +Boolean emailVerified
    +String firstName
    +String lastName
    +String otpCode
    +LocalDateTime otpExpiresAt
    +String pw
    +String profileImage
  }

  %% Repository
  class MemberRepository {
  }
  <<interface>> MemberRepository

  %% Service
  class CourseService {
    +List<Course> getAllCourses()
    +Course findById(id)
    +Course findByTitle(title)
  }

  %% Controllers
  class HomeController {
    +String homePage(Model)
  }

  class ContentsController {
    +String contents(Model, String courseId, String selected, String title)
  }

  %% Application (optional)
  class MyanmyanlearnApplication {
    +static void main(String[])
  }

  %% Relationships
  Course "1" --> "0..*" Content : contents
  Content "1" --> "0..*" Subcontent : subcontents

  MemberRepository --> Member : manages
  HomeController --> CourseService : uses
  HomeController --> MemberRepository : uses
  ContentsController --> CourseService : uses
  CourseService --> Course : loads

  %% Additional Models / Entities
  class CourseCatalog {
    +List<Course> courses
  }

  class OtpVerification {
    +Long id
    +String userId
    +String email
    +String otpCode
    +LocalDateTime createdAt
    +LocalDateTime expiresAt
    +Boolean verified
    +LocalDateTime verifiedAt
    +Integer attempts
  }

  class Role {
    +String userId
    +String role
  }

  class RoleId {
    +String userId
    +String role
  }

  class PasswordResetToken {
    +Long id
    +String email
    +String token
    +Instant expireTime
  }

  %% Repositories (interfaces)
  class RoleRepository
  <<interface>> RoleRepository
  class OtpVerificationRepository
  <<interface>> OtpVerificationRepository
  class PasswordResetTokenRepository
  <<interface>> PasswordResetTokenRepository

  %% Services
  class RegistrationService
  class OtpService
  class EmailService
  class JwtService
  class LoginAttemptService
  class PasswordValidationService

  %% Controllers
  class AppIntroController
  class EmailTestController
  class ForgetPasswordController
  class LoginController
  class MainController
  class ProfileController
  class ReaderController
  class SelectLanguageController
  class SignUpController
  class SplashController

  %% Web / Config / Security
  class WebConfig
  class SecurityConfig
  class CustomAuthenticationSuccessHandler
  class GlobalNavbarModel

  %% Application
  class MyanmyanlearnApplication

  %% Entity relationships
  Member "1" o-- "0..*" Role : roles
  Role "*" --> "1" Member : member
  Member "1" o-- "0..*" OtpVerification : otpVerifications
  OtpVerification "*" --> "1" Member : member

  %% Repository -> Entity relations
  MemberRepository --> Member : manages
  RoleRepository --> Role : manages
  OtpVerificationRepository --> OtpVerification : manages
  PasswordResetTokenRepository --> PasswordResetToken : manages

  %% Service -> Repository/Entity relations
  RegistrationService --> MemberRepository : uses
  RegistrationService --> RoleRepository : uses
  RegistrationService --> EmailService : uses
  RegistrationService --> OtpService : uses
  OtpService --> OtpVerificationRepository : uses
  EmailService ..> JavaMailSender : uses
  JwtService ..> PasswordResetToken : issues tokens
  LoginAttemptService ..> JdbcTemplate : uses
  ForgetPasswordController --> JwtService : uses
  ForgetPasswordController --> PasswordResetTokenRepository : uses
  ForgetPasswordController --> EmailService : uses
  ForgetPasswordController --> MemberRepository : uses

  %% Controllers -> Services
  AppIntroController ..> WebConfig : reads cookie
  EmailTestController --> EmailService : uses
  LoginController --> LoginAttemptService : uses
  LoginController --> RegistrationService : uses
  SignUpController --> RegistrationService : uses
  SignUpController --> OtpService : uses
  ProfileController --> MemberRepository : uses
  ProfileController --> PasswordEncoder : uses
  ReaderController --> CourseService : uses
  ContentsController --> CourseService : uses
  HomeController --> MemberRepository : uses
  HomeController --> CourseService : uses

  %% Security
  SecurityConfig --> CustomAuthenticationSuccessHandler : uses
  SecurityConfig ..> UserDetailsManager : provides
  SecurityConfig ..> DataSource : config
  CustomAuthenticationSuccessHandler --> MemberRepository : uses
  CustomAuthenticationSuccessHandler --> EmailService : uses
  CustomAuthenticationSuccessHandler --> OtpService : uses

  %% Web layer helpers
  GlobalNavbarModel --> MemberRepository : uses

  %% Misc
  CourseCatalog --> Course : aggregates
